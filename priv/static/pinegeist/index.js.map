{"version":3,"sources":["../../../assets/js/pinegeist/live.js","../../../assets/js/pinegeist/utils.js","../../../assets/js/pinegeist/hook.js","../../../assets/js/pinegeist/plugin.js"],"sourcesContent":["export class LiveHelper {\n  #viewHook\n  #command\n\n  constructor(viewHook) {\n    this.#viewHook = viewHook\n    this.#command = new Proxy(\n      {},\n      {\n        get(_target, name) {\n          return (params) => viewHook.liveSocket.execJS(viewHook.el, JSON.stringy([[name, params]]))\n        }\n      }\n    )\n  }\n\n  get js() {\n    return this.#command\n  }\n\n  on(event, onEvent) {\n    this.#viewHook.handleEvent(event, onEvent)\n  }\n\n  push(event, payload, onReply) {\n    this.#viewHook.pushEvent(event, payload, onReply)\n  }\n}\n","export const noop = () => {}\n\nexport const markRaw = (value) => {\n  if (Object.isExtensible(value)) {\n    Object.defineProperty(value, \"__v_skip\", { configurable: true, enumerable: false, value: true })\n  }\n  return value\n}\n","import { LiveHelper } from \"./live\"\nimport { markRaw } from \"./utils\"\n\n/**\n * @param {import(\"alpinejs\").Alpine} Alpine\n */\nexport const createHooks = (Alpine) => ({\n  Prop: {\n    mounted() {\n      this.update()\n    },\n    updated() {\n      this.update()\n    },\n    get name() {\n      return this.el.dataset.name\n    },\n    get value() {\n      return JSON.parse(this.el.innerText)\n    },\n    update() {\n      Alpine.$data(this.el).__pinegeist_props[this.name] = this.value\n    }\n  },\n  Render: {\n    mounted() {\n      Alpine.$data(this.el).__pinegeist_live_helper = markRaw({ value: new LiveHelper(this) })\n    }\n  }\n})\n","import { markRaw, noop } from \"./utils\"\n\n// an object that always return a noop function when accessed\n// the lv helper is initialized only after LiveView has mounted\n// returns a noop object when LiveView is not ready\nconst dummy = new Proxy(\n  {},\n  {\n    get() {\n      return noop\n    }\n  }\n)\n\n/**\n * @type {import(\"alpinejs\").PluginCallback}\n */\nexport const plugin = (Alpine) => {\n  Alpine.directive(\"pinegeist\", (el) => {\n    Alpine.bind(el, {\n      \"x-data\"() {\n        return {\n          __pinegeist_props: {},\n          __pinegeist_live_helper: markRaw({ value: dummy })\n        }\n      }\n    })\n  })\n\n  Alpine.directive(\"live-on\", (el, { value, expression }, { evaluate }) => {\n    Alpine.$data(el).__pinegeist_live_helper.value.on(value, (payload) => {\n      evaluate(expression, { scope: { $payload: payload, params: [payload] } })\n    })\n  })\n\n  Alpine.magic(\"props\", (el) => Alpine.$data(el).__pinegeist_props)\n  Alpine.magic(\"live\", (el) => Alpine.$data(el).__pinegeist_live_helper.value)\n}\n"],"mappings":";AAAO,IAAM,aAAN,MAAiB;AAAA,EACtB;AAAA,EACA;AAAA,EAEA,YAAY,UAAU;AACpB,SAAK,YAAY;AACjB,SAAK,WAAW,IAAI;AAAA,MAClB,CAAC;AAAA,MACD;AAAA,QACE,IAAI,SAAS,MAAM;AACjB,iBAAO,CAAC,WAAW,SAAS,WAAW,OAAO,SAAS,IAAI,KAAK,QAAQ,CAAC,CAAC,MAAM,MAAM,CAAC,CAAC,CAAC;AAAA,QAC3F;AAAA,MACF;AAAA,IACF;AAAA,EACF;AAAA,EAEA,IAAI,KAAK;AACP,WAAO,KAAK;AAAA,EACd;AAAA,EAEA,GAAG,OAAO,SAAS;AACjB,SAAK,UAAU,YAAY,OAAO,OAAO;AAAA,EAC3C;AAAA,EAEA,KAAK,OAAO,SAAS,SAAS;AAC5B,SAAK,UAAU,UAAU,OAAO,SAAS,OAAO;AAAA,EAClD;AACF;;;AC3BO,IAAM,OAAO,MAAM;AAAC;AAEpB,IAAM,UAAU,CAAC,UAAU;AAChC,MAAI,OAAO,aAAa,KAAK,GAAG;AAC9B,WAAO,eAAe,OAAO,YAAY,EAAE,cAAc,MAAM,YAAY,OAAO,OAAO,KAAK,CAAC;AAAA,EACjG;AACA,SAAO;AACT;;;ACDO,IAAM,cAAc,CAAC,YAAY;AAAA,EACtC,MAAM;AAAA,IACJ,UAAU;AACR,WAAK,OAAO;AAAA,IACd;AAAA,IACA,UAAU;AACR,WAAK,OAAO;AAAA,IACd;AAAA,IACA,IAAI,OAAO;AACT,aAAO,KAAK,GAAG,QAAQ;AAAA,IACzB;AAAA,IACA,IAAI,QAAQ;AACV,aAAO,KAAK,MAAM,KAAK,GAAG,SAAS;AAAA,IACrC;AAAA,IACA,SAAS;AACP,aAAO,MAAM,KAAK,EAAE,EAAE,kBAAkB,KAAK,IAAI,IAAI,KAAK;AAAA,IAC5D;AAAA,EACF;AAAA,EACA,QAAQ;AAAA,IACN,UAAU;AACR,aAAO,MAAM,KAAK,EAAE,EAAE,0BAA0B,QAAQ,EAAE,OAAO,IAAI,WAAW,IAAI,EAAE,CAAC;AAAA,IACzF;AAAA,EACF;AACF;;;ACxBA,IAAM,QAAQ,IAAI;AAAA,EAChB,CAAC;AAAA,EACD;AAAA,IACE,MAAM;AACJ,aAAO;AAAA,IACT;AAAA,EACF;AACF;AAKO,IAAM,SAAS,CAAC,WAAW;AAChC,SAAO,UAAU,aAAa,CAAC,OAAO;AACpC,WAAO,KAAK,IAAI;AAAA,MACd,WAAW;AACT,eAAO;AAAA,UACL,mBAAmB,CAAC;AAAA,UACpB,yBAAyB,QAAQ,EAAE,OAAO,MAAM,CAAC;AAAA,QACnD;AAAA,MACF;AAAA,IACF,CAAC;AAAA,EACH,CAAC;AAED,SAAO,UAAU,WAAW,CAAC,IAAI,EAAE,OAAO,WAAW,GAAG,EAAE,SAAS,MAAM;AACvE,WAAO,MAAM,EAAE,EAAE,wBAAwB,MAAM,GAAG,OAAO,CAAC,YAAY;AACpE,eAAS,YAAY,EAAE,OAAO,EAAE,UAAU,SAAS,QAAQ,CAAC,OAAO,EAAE,EAAE,CAAC;AAAA,IAC1E,CAAC;AAAA,EACH,CAAC;AAED,SAAO,MAAM,SAAS,CAAC,OAAO,OAAO,MAAM,EAAE,EAAE,iBAAiB;AAChE,SAAO,MAAM,QAAQ,CAAC,OAAO,OAAO,MAAM,EAAE,EAAE,wBAAwB,KAAK;AAC7E;","names":[]}