{"version":3,"sources":["../../../assets/js/pinegeist/live.js","../../../assets/js/pinegeist/hook.js","../../../assets/js/pinegeist/utils.js","../../../assets/js/pinegeist/plugin.js"],"sourcesContent":["export class LiveHelper {\n  #viewHook\n  #command\n\n  constructor(viewHook) {\n    this.#viewHook = viewHook\n    this.#command = new Proxy(\n      {},\n      {\n        get(_target, name) {\n          return (params) =>\n            viewHook.liveSocket.execJS(viewHook.el, JSON.stringify([[name, params]]))\n        }\n      }\n    )\n  }\n\n  get js() {\n    return this.#command\n  }\n\n  on(event, onEvent) {\n    this.#viewHook.handleEvent(event, onEvent)\n  }\n\n  push(event, payload, onReply) {\n    this.#viewHook.pushEvent(event, payload, onReply)\n  }\n}\n","import { LiveHelper } from \"./live\"\n\nlet started = false\n\n/**\n * @param {import(\"alpinejs\").Alpine} Alpine\n */\nexport const createPinegeistHook = (Alpine) => ({\n  mounted() {\n    this.isProp = this.el.dataset.prop != null\n\n    const root = this.el.closest(\"pinegeist-island\")\n    if (!root.__live_helper) {\n      root.__live_helper = new LiveHelper(this)\n    }\n\n    if (!started) {\n      Alpine.start()\n      started = true\n    }\n\n    if (this.isProp) {\n      this.propName = this.el.dataset.name\n      this.updatePropValue()\n    }\n  },\n  updated() {\n    if (!this.isProp) return\n    this.updatePropValue()\n  },\n  getPropValue() {\n    return JSON.parse(this.el.innerText)\n  },\n  updatePropValue() {\n    Alpine.$data(this.el).__pinegeist_props[this.propName] = this.getPropValue()\n  }\n})\n","export const markRaw = (value) => {\n  if (Object.isExtensible(value)) {\n    Object.defineProperty(value, \"__v_skip\", { configurable: true, enumerable: false, value: true })\n  }\n  return value\n}\n","import { markRaw } from \"./utils\"\n\n/**\n * @type {import(\"alpinejs\").PluginCallback}\n */\nexport const pinegeist = (Alpine) => {\n  Alpine.directive(\"live-on\", (el, { value, expression }, { evaluate }) => {\n    Alpine.$data(el).__pinegeist_live_helper.value.on(value, (payload) => {\n      evaluate(expression, { scope: { $payload: payload, params: [payload] } })\n    })\n  })\n\n  Alpine.directive(\"pinegeist\", (el) => {\n    const component = Alpine.$data(el)\n    component.__pinegeist_props = {}\n    component.__pinegeist_live_helper = markRaw({ value: el.__live_helper })\n  }).before(\"live-on\")\n\n  Alpine.magic(\"props\", (el) => Alpine.$data(el).__pinegeist_props)\n  Alpine.magic(\"live\", (el) => Alpine.$data(el).__pinegeist_live_helper.value)\n}\n"],"mappings":";AAAO,IAAM,aAAN,MAAiB;AAAA,EACtB;AAAA,EACA;AAAA,EAEA,YAAY,UAAU;AACpB,SAAK,YAAY;AACjB,SAAK,WAAW,IAAI;AAAA,MAClB,CAAC;AAAA,MACD;AAAA,QACE,IAAI,SAAS,MAAM;AACjB,iBAAO,CAAC,WACN,SAAS,WAAW,OAAO,SAAS,IAAI,KAAK,UAAU,CAAC,CAAC,MAAM,MAAM,CAAC,CAAC,CAAC;AAAA,QAC5E;AAAA,MACF;AAAA,IACF;AAAA,EACF;AAAA,EAEA,IAAI,KAAK;AACP,WAAO,KAAK;AAAA,EACd;AAAA,EAEA,GAAG,OAAO,SAAS;AACjB,SAAK,UAAU,YAAY,OAAO,OAAO;AAAA,EAC3C;AAAA,EAEA,KAAK,OAAO,SAAS,SAAS;AAC5B,SAAK,UAAU,UAAU,OAAO,SAAS,OAAO;AAAA,EAClD;AACF;;;AC1BA,IAAI,UAAU;AAKP,IAAM,sBAAsB,CAAC,YAAY;AAAA,EAC9C,UAAU;AACR,SAAK,SAAS,KAAK,GAAG,QAAQ,QAAQ;AAEtC,UAAM,OAAO,KAAK,GAAG,QAAQ,kBAAkB;AAC/C,QAAI,CAAC,KAAK,eAAe;AACvB,WAAK,gBAAgB,IAAI,WAAW,IAAI;AAAA,IAC1C;AAEA,QAAI,CAAC,SAAS;AACZ,aAAO,MAAM;AACb,gBAAU;AAAA,IACZ;AAEA,QAAI,KAAK,QAAQ;AACf,WAAK,WAAW,KAAK,GAAG,QAAQ;AAChC,WAAK,gBAAgB;AAAA,IACvB;AAAA,EACF;AAAA,EACA,UAAU;AACR,QAAI,CAAC,KAAK;AAAQ;AAClB,SAAK,gBAAgB;AAAA,EACvB;AAAA,EACA,eAAe;AACb,WAAO,KAAK,MAAM,KAAK,GAAG,SAAS;AAAA,EACrC;AAAA,EACA,kBAAkB;AAChB,WAAO,MAAM,KAAK,EAAE,EAAE,kBAAkB,KAAK,QAAQ,IAAI,KAAK,aAAa;AAAA,EAC7E;AACF;;;ACpCO,IAAM,UAAU,CAAC,UAAU;AAChC,MAAI,OAAO,aAAa,KAAK,GAAG;AAC9B,WAAO,eAAe,OAAO,YAAY,EAAE,cAAc,MAAM,YAAY,OAAO,OAAO,KAAK,CAAC;AAAA,EACjG;AACA,SAAO;AACT;;;ACAO,IAAM,YAAY,CAAC,WAAW;AACnC,SAAO,UAAU,WAAW,CAAC,IAAI,EAAE,OAAO,WAAW,GAAG,EAAE,SAAS,MAAM;AACvE,WAAO,MAAM,EAAE,EAAE,wBAAwB,MAAM,GAAG,OAAO,CAAC,YAAY;AACpE,eAAS,YAAY,EAAE,OAAO,EAAE,UAAU,SAAS,QAAQ,CAAC,OAAO,EAAE,EAAE,CAAC;AAAA,IAC1E,CAAC;AAAA,EACH,CAAC;AAED,SAAO,UAAU,aAAa,CAAC,OAAO;AACpC,UAAM,YAAY,OAAO,MAAM,EAAE;AACjC,cAAU,oBAAoB,CAAC;AAC/B,cAAU,0BAA0B,QAAQ,EAAE,OAAO,GAAG,cAAc,CAAC;AAAA,EACzE,CAAC,EAAE,OAAO,SAAS;AAEnB,SAAO,MAAM,SAAS,CAAC,OAAO,OAAO,MAAM,EAAE,EAAE,iBAAiB;AAChE,SAAO,MAAM,QAAQ,CAAC,OAAO,OAAO,MAAM,EAAE,EAAE,wBAAwB,KAAK;AAC7E;","names":[]}